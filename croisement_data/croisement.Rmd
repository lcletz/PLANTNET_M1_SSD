---
title: "Croisement"
author: "AIGOIN Emilie"
date: "2025-03-10"
output: html_document
---

Croiser les données de samples et de tasks : échantillon de 1 000 000 lignes

```{r}

# Approche très simplifiée
croisement_simple <- function(chemin_resultat, chemin_tasks, chemin_sortie) {
  library(jsonlite)
  
  # Charger les fichiers JSON
  resultat <- fromJSON(chemin_resultat, simplifyVector = FALSE)
  tasks <- fromJSON(chemin_tasks, simplifyVector = FALSE)
  
  # Pour chaque observation (clé) dans le résultat
  for (obs_id in names(resultat)) {
    # Récupérer la valeur attendue pour cette observation
    expected_value <- NULL
    if (obs_id %in% names(tasks)) {
      expected_value <- tasks[[obs_id]]$answer_value
    }
    
    # Pour chaque élément dans cette observation
    for (i in 1:length(resultat[[obs_id]])) {
      item <- resultat[[obs_id]][[i]]
      
      # Vérifier la correspondance
      if (!is.null(expected_value) && !is.null(item$second_id) && 
          item$second_id == expected_value) {
        resultat[[obs_id]][[i]]$correct <- 1
      } else {
        resultat[[obs_id]][[i]]$correct <- 0
      }
    }
  }
  
  # Écrire le résultat
  writeLines(toJSON(resultat, pretty = TRUE, auto_unbox = TRUE), chemin_sortie)
  
  cat("Terminé. Résultat enregistré dans:", chemin_sortie, "\n")
  return(resultat)
}

# Exemple d'utilisation
resultat_croise <- croisement_simple("/Users/emilieaigoin/Desktop/Test-ordinateur/multiple_data/sample_1000123.json", "/Users/emilieaigoin/Desktop/Test-ordinateur/multiple_data/tasks_answers_merged.json", "/Users/emilieaigoin/Desktop/Test-ordinateur/multiple_data/RESULTATS_1000123.json")

```


